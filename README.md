# üè• OsplyfC Dashboard - Sistema de Gesti√≥n de Expedientes

Dashboard moderno para la Obra Social del Personal de Luz y Fuerza de C√≥rdoba (OsplyfC) que integra con ProcessMaker 3.4.9 Community Edition.

## üìã Descripci√≥n

Este proyecto implementa un dashboard responsivo que reemplaza el HOME de ProcessMaker, proporcionando una interfaz moderna para gestionar los 14 tipos de expedientes utilizados en el sistema GECROS de OsplyfC.

## üèóÔ∏è Arquitectura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     FRONTEND        ‚îÇ    ‚îÇ   PROCESSMAKER      ‚îÇ    ‚îÇ      GECROS         ‚îÇ
‚îÇ                     ‚îÇ    ‚îÇ                     ‚îÇ    ‚îÇ                     ‚îÇ
‚îÇ  Angular 17+        ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ  REST API 3.4.9     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   14 Tipos de       ‚îÇ
‚îÇ  Standalone Comp.   ‚îÇ    ‚îÇ  Community Edition  ‚îÇ    ‚îÇ   Expedientes       ‚îÇ
‚îÇ  Angular Material   ‚îÇ    ‚îÇ                     ‚îÇ    ‚îÇ                     ‚îÇ
‚îÇ  TailwindCSS        ‚îÇ    ‚îÇ  Workspace: OsplyfC ‚îÇ    ‚îÇ   Workflow GECROS   ‚îÇ
‚îÇ                     ‚îÇ    ‚îÇ                     ‚îÇ    ‚îÇ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üöÄ Caracter√≠sticas

### ‚úÖ Implementado

- **Autenticaci√≥n ProcessMaker 3.4:** Login session-based completo
- **Dashboard Responsivo:** Interfaz moderna con Angular Material
- **14 Tipos de Expedientes:** Seg√∫n especificaciones GECROS
- **M√©tricas en Tiempo Real:** Estad√≠sticas de casos y actividad
- **Gesti√≥n de Usuarios:** Roles y permisos integrados
- **Auto-refresh:** Actualizaci√≥n autom√°tica de datos
- **Persistencia de Sesi√≥n:** Manejo completo de tokens
- **Error Handling:** Manejo robusto de errores y reconexi√≥n

### üîÑ En Desarrollo

- **Inicio de Expedientes:** Funcionalidad para crear nuevos casos
- **Reportes Avanzados:** M√©tricas espec√≠ficas por departamento
- **Notificaciones:** Sistema de alertas y notificaciones
- **Integraci√≥n N8N:** Workflows autom√°ticos (opcional)

## üõ†Ô∏è Stack Tecnol√≥gico

### Frontend
- **Framework:** Angular 17+ con Standalone Components
- **UI Library:** Angular Material 17
- **Styling:** TailwindCSS + Angular Material Theme
- **Estado:** Angular Signals
- **HTTP:** Angular HttpClient con interceptors
- **Build:** Angular CLI con Vite

### Backend Integration
- **ProcessMaker:** v3.4.9 Community Edition
- **Workspace:** OsplyfC
- **API:** REST API /api/1.0/OsplyfC
- **Autenticaci√≥n:** Session-based (NO OAuth 2.0)

## üì¶ Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

- Node.js 18+ y npm 9+
- Angular CLI 17+
- ProcessMaker 3.4.9 funcionando en https://bpm.micam.com.ar/sysOsplyfC
- Acceso a workspace OsplyfC

### 1. Clonar e Instalar

```bash
# Clonar repositorio
git clone [URL_REPO]
cd osplyfc-dashboard

# Instalar dependencias
npm install
```

### 2. Configuraci√≥n de Environment

```typescript
// src/environments/environment.ts
export const environment = {
  production: false,
  processMakerUrl: 'https://bpm.micam.com.ar/sysOsplyfC',
  workspace: 'OsplyfC',
  processMakerEndpoints: {
    auth: {
      login: '/api/1.0/{workspace}/login',
      logout: '/api/1.0/{workspace}/logout',
      user: '/api/1.0/{workspace}/user'
    },
    api: {
      cases: '/api/1.0/{workspace}/cases',
      casesTodo: '/api/1.0/{workspace}/cases/todo',
      casesSent: '/api/1.0/{workspace}/cases/sent',
      processes: '/api/1.0/{workspace}/processes'
    }
  },
  refreshInterval: 300000 // 5 minutos
};
```

### 3. Desarrollo

```bash
# Servidor de desarrollo
ng serve

# Abrir en navegador
http://localhost:4200
```

### 4. Build para Producci√≥n

```bash
# Build optimizado
ng build --configuration production

# Los archivos se generan en dist/osplyfc/
```

## üîê Autenticaci√≥n

### ProcessMaker 3.4 Session-Based Auth

La aplicaci√≥n utiliza autenticaci√≥n tradicional de ProcessMaker 3.4:

```typescript
// Flujo de autenticaci√≥n:
1. POST /api/1.0/OsplyfC/login con credenciales
2. Respuesta con access_token y datos de usuario
3. Almacenamiento en localStorage + cookies de sesi√≥n
4. Headers Authorization en requests posteriores
5. Auto-refresh de token cuando sea necesario
```

### Endpoints Principales

```bash
# Login
POST /api/1.0/OsplyfC/login
Body: { "usr_username": "user", "usr_password": "pass" }

# User Info
GET /api/1.0/OsplyfC/user
Headers: Authorization: Bearer {token}

# Cases
GET /api/1.0/OsplyfC/cases/todo
GET /api/1.0/OsplyfC/cases/sent

# Logout
POST /api/1.0/OsplyfC/logout
```

## üìÅ Estructura del Proyecto

```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ core/                    # Servicios y utilidades core
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guards/             # Route guards
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interceptors/       # HTTP interceptors
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services/           # Servicios principales
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ auth.service.ts          # Autenticaci√≥n
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ processmaker.service.ts  # API ProcessMaker
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ dashboard.service.ts     # Datos dashboard
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ features/               # Features de la aplicaci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/              # M√≥dulo de autenticaci√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.component.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth-callback.component.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dashboard/         # Dashboard principal
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ dashboard.component.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ shared/                # Componentes compartidos
‚îÇ   ‚îî‚îÄ‚îÄ app.routes.ts          # Configuraci√≥n de rutas
‚îÇ
‚îú‚îÄ‚îÄ environments/              # Configuraci√≥n por ambiente
‚îú‚îÄ‚îÄ assets/                   # Recursos est√°ticos
‚îî‚îÄ‚îÄ styles.css               # Estilos globales
```

## üè¢ Expedientes OsplyfC

### 14 Tipos Implementados

| # | Expediente | Departamento | Descripci√≥n |
|---|---|---|---|
| 1 | **Autorizaci√≥n** | Auditor√≠a | Medicamentos, materiales, sondas |
| 2 | **Correspondencia Varios** | Variable | Recetarios, certificados CUD |
| 3 | **Legajo** | Personal | Documentaci√≥n empleados |
| 4 | **Factura M√©dica** | Facturaci√≥n | Cl√≠nicas, sanatorios |
| 5 | **Factura Proveedores** | Facturaci√≥n | Servicios generales |
| 6 | **Reintegros** | Auditor√≠a | Prestaciones fuera de red |
| 7 | **SUR Medicaci√≥n** | Auditor√≠a | Sistema √önico Reintegros |
| 8 | **Carta Documento** | Legales | Documentaci√≥n legal |
| 9 | **Nota** | Variable | Oficios, c√©dulas, amparos |
| 10 | **Presupuestos** | Auditor√≠a | Prestaciones no convenidas |
| 11 | **Hospitales P√∫blicos** | Facturaci√≥n | Verificaci√≥n cobertura |
| 12 | **Despachos** | General | Env√≠os a delegaciones |
| 13 | **Carpeta Discapacidad** | Junta | Revisi√≥n facturas |
| 14 | **Correo Argentino** | Complementario | Cartas certificadas |

### Flujo General GECROS

```
INICIO (Mesa de Entrada / CAB)
    ‚Üì
IDENTIFICACI√ìN AUTOM√ÅTICA √ÅREA ORIGEN
    ‚Üì
VALIDACI√ìN Y COMPLETADO DE DATOS
    ‚Üì
RUTEO AUTOM√ÅTICO AL √ÅREA DESTINO
    ‚Üì
EVALUACI√ìN/PROCESAMIENTO
    ‚Üì
DECISI√ìN (Aprobado/Rechazado/M√°s Info)
    ‚Üì
COMUNICACI√ìN (Opcional via CAB)
    ‚Üì
FINALIZACI√ìN Y M√âTRICAS
```

## üéØ Roles y Permisos

### Estructura Organizacional

```
OsplyfC (Ra√≠z)
‚îú‚îÄ‚îÄ Mesa de Entrada
‚îú‚îÄ‚îÄ CAB (Centro de Atenci√≥n al Beneficiario)
‚îú‚îÄ‚îÄ Auditor√≠a
‚îÇ   ‚îú‚îÄ‚îÄ Auditor√≠a M√©dica
‚îÇ   ‚îú‚îÄ‚îÄ Auditor√≠a Odontol√≥gica
‚îÇ   ‚îî‚îÄ‚îÄ Auditor√≠a Salud Mental
‚îú‚îÄ‚îÄ Facturaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ Facturaci√≥n General
‚îÇ   ‚îî‚îÄ‚îÄ Facturaci√≥n 4to Piso
‚îú‚îÄ‚îÄ Legales
‚îú‚îÄ‚îÄ Recursos Humanos
‚îî‚îÄ‚îÄ Junta de Discapacidad
```

### Roles Definidos

- **ROL_MESA_ENTRADA:** Operadores de ingreso
- **ROL_CAB_OPERADOR:** Centro de atenci√≥n
- **ROL_AUDITOR_MEDICO:** Profesionales auditores
- **ROL_SUPERVISOR_AUDITORIA:** Supervisi√≥n y gesti√≥n

## üîß Desarrollo

### Comandos √ötiles

```bash
# Desarrollo
npm start                    # ng serve
npm run build               # ng build
npm run build:prod         # ng build --configuration production
npm test                   # ng test
npm run lint              # ng lint

# An√°lisis
npm run analyze           # webpack-bundle-analyzer
```

### Testing

```bash
# Tests unitarios
ng test

# Tests e2e
ng e2e

# Cobertura
ng test --code-coverage
```

### Debug de Autenticaci√≥n

```javascript
// En DevTools Console - verificar estado:
console.table({
  token: localStorage.getItem('access_token'),
  user: JSON.parse(localStorage.getItem('currentUser') || '{}'),
  expires: new Date(parseInt(localStorage.getItem('expires_at')))
});

// Limpiar sesi√≥n manualmente:
['access_token', 'token_type', 'refresh_token', 'expires_at', 'currentUser']
  .forEach(key => localStorage.removeItem(key));
```

## üöÄ Deployment

### Build de Producci√≥n

```bash
# Build optimizado
ng build --configuration production

# Los archivos est√°n en: dist/osplyfc/
```

### Configuraci√≥n del Servidor

```nginx
# nginx.conf ejemplo:
server {
    listen 80;
    server_name dashboard.osplyfc.com.ar;
    
    location / {
        root /var/www/osplyfc-dashboard;
        try_files $uri $uri/ /index.html;
    }
    
    # Cach√© para assets est√°ticos
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### Variables de Entorno - Producci√≥n

```typescript
// src/environments/environment.prod.ts
export const environment = {
  production: true,
  processMakerUrl: 'https://bpm.micam.com.ar/sysOsplyfC',
  workspace: 'OsplyfC',
  refreshInterval: 300000,
  retryAttempts: 3
};
```

## üîß Troubleshooting

### Problemas Comunes

#### Error 404 en Login
```
Causa: Uso del endpoint /light (no disponible en PM 3.4)
Soluci√≥n: Verificar que se use /login en lugar de /light
```

#### CORS Errors
```
Causa: Configuraci√≥n incorrecta de headers
Soluci√≥n: Asegurar withCredentials: true en requests
```

#### Token No Persiste
```
Causa: Error en checkStoredAuth()
Soluci√≥n: Verificar localStorage y llamadas en constructor
```

#### Redirecciones Infinitas
```
Causa: L√≥gica incorrecta en AuthGuard
Soluci√≥n: Revisar condiciones de autenticaci√≥n
```

### Logs de Debug

```
‚úÖ Funcionamiento Normal:
üîë Intentando login en ProcessMaker 3.4...
‚úÖ Login exitoso: {access_token: "...", user: {...}}
üíæ Sesi√≥n guardada, expira en: [fecha]
üë§ Usuario establecido: [username]

‚ùå Errores Comunes:
‚ùå ProcessMaker Login error: [details]
‚è∞ Token expirado, limpiando sesi√≥n
üö™ Error de autenticaci√≥n, redirigiendo al login
```

## üìö Documentaci√≥n Adicional

- [ProcessMaker 3.4 REST API](https://wiki.processmaker.com/3.1/REST_API)
- [Angular Material](https://material.angular.io/)
- [Testing Guide](./TESTING_GUIDE.md)
- [Contexto del Proyecto](./docs/CONTEXTO_PROYECTO.md)

## ü§ù Contribuci√≥n

### Flujo de Desarrollo

1. Fork del repositorio
2. Crear rama feature: `git checkout -b feature/nueva-funcionalidad`
3. Commit cambios: `git commit -am 'Add: nueva funcionalidad'`
4. Push rama: `git push origin feature/nueva-funcionalidad`
5. Crear Pull Request

### Est√°ndares de C√≥digo

- **Linting:** ESLint + Prettier
- **Commits:** Conventional Commits
- **Testing:** Jest + Angular Testing Library
- **Cobertura:** M√≠nimo 80%

## üìÑ Licencia

Proyecto privado - OsplyfC (Obra Social del Personal de Luz y Fuerza de C√≥rdoba)

## üë• Equipo

- **Desarrollo:** [Nombre del desarrollador]
- **Cliente:** OsplyfC
- **Consultor√≠a:** [Nombre de la consultora]

## üìû Soporte

Para soporte t√©cnico o consultas:

- **Email:** [email_soporte]
- **ProcessMaker:** https://bpm.micam.com.ar/sysOsplyfC
- **Documentaci√≥n:** [URL_documentacion]

---

**üè• OsplyfC - Obra Social del Personal de Luz y Fuerza de C√≥rdoba**
*Sistema de Gesti√≥n de Expedientes - Dashboard v1.0.0*